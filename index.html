<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Telegram Mini App — JS Template</title>
<link href="https://fonts.googleapis.com/css2?family=Arsenal+SC:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    background: #ffffff;
    color: #000000;
    font-family: "Roboto", sans-serif;
    -webkit-tap-highlight-color: transparent;
  }
  .container { padding: 12px; max-width: 640px; margin: auto; }
  .window {
    background: rgba(0,0,0,0.03);
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
  }

  .btn {
    border: none;
    padding: 14px;
    border-radius: 35px;
    color: #ffffff;
    cursor: pointer;
    width: 100%;
    font-size: 17px;
    font-family: "Arsenal SC", sans-serif;
    margin-top: 12px;
  }
  .btn-green { background: #4C614E; }
  .btn-brown { background: #775541; }
  .btn-disabled { opacity: 0.5; pointer-events: none; }

  h2, h3 { font-family: "Arsenal SC", sans-serif; color: #000; }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 8px;
  }
  .thumb {
    width: 100%; height: 100px;
    object-fit: cover;
    border-radius: 6px;
    cursor: pointer;
  }

  @media (max-width: 480px) {
    .container { padding: 8px; }
    .btn { font-size: 16px; padding: 12px; }
    .thumb { height: 90px; }
  }
</style>
</head>
<body>
<div class="container">
  <div id="app"></div>
</div>

<script>
const tg = window.Telegram?.WebApp || null;
if (tg) tg.expand();

let images = [
  { id: genId(), name: "Demo 1", url: "https://picsum.photos/300/300?1" },
  { id: genId(), name: "Demo 2", url: "https://picsum.photos/300/300?2" },
  { id: genId(), name: "Demo 3", url: "https://picsum.photos/300/300?3" }
];

let currentScreen = { name: "start", props: {} };

function navigate(name, props = {}) {
  currentScreen = { name, props };
  render();
}

function render() {
  const root = document.getElementById("app");
  root.innerHTML = templates[currentScreen.name](currentScreen.props);
  attachEvents();
}

const templates = {
  start: () => `
    <div class="window" style="text-align:center; padding-top:20px;">
      <img src="logo2.png" alt="logo" style="width:160px; height:auto; margin-bottom:20px;" />

      <button class="btn btn-green" id="choose-scenario">Выбрать сценарий</button>
      <button class="btn btn-brown btn-disabled">Случайная игра</button>
    </div>
  `,

  scenario_list: () => `
    <div class="window">
      <h3>Выбор сценария</h3>

      <div class="gallery-grid">
        ${images.map(img => `<img src="${img.url}" class="thumb view-img" data-id="${img.id}">`).join("")}
      </div>

      <button class="btn btn-brown" id="back">Назад</button>
    </div>
  `,

  viewer: ({ id }) => {
    const img = images.find(x => x.id === id);
    return `
      <div class="window">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3>${img.name}</h3>
          <button class="btn btn-brown" id="back">Закрыть</button>
        </div>
        <img src="${img.url}" style="width:100%; max-height:70vh; object-fit:contain; margin-top:12px;" />
      </div>
    `;
  }
};

function attachEvents() {
  const choose = document.getElementById("choose-scenario");
  if (choose) choose.onclick = () => navigate("scenario_list");

  const back = document.getElementById("back");
  if (back) back.onclick = () => navigate("start");

  document.querySelectorAll(".view-img").forEach(img => {
    img.onclick = () => navigate("viewer", { id: img.dataset.id });
  });
}

function genId() {
  return Math.random().toString(36).slice(2) + Date.now().toString(36);
}

render();
</script>
</body>
</html>
